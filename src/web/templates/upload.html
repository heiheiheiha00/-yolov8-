<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>è¿åŠ¨åŠ¨ä½œåˆ†æç³»ç»Ÿ</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
  </head>
  <body>
    <div class="container">
      <h1>ğŸƒ è¿åŠ¨åŠ¨ä½œåˆ†æç³»ç»Ÿ</h1>
      <p class="upload-hint">
        ğŸ“Œ <strong>ä¸Šä¼ æç¤ºï¼š</strong>è¯·å°½é‡ç¡®ä¿è¾“å…¥è§†é¢‘çš„ç›®æ ‡äººç‰©å®Œæ•´ã€å¤§å°åˆé€‚ã€èƒŒæ™¯å¹²å‡€ï¼Œä¸”ç›®æ ‡äººç‰©ä¸è¦å‡ºç°å¿«é€Ÿã€å¤§è§„æ¨¡çš„æ™ƒåŠ¨ï¼Œä»¥è·å¾—æœ€ä½³åˆ†ææ•ˆæœã€‚
      </p>
      {% with messages = get_flashed_messages() %}
        {% if messages %}
          <div class="flash">
            {% for message in messages %}
              <p>{{ message }}</p>
            {% endfor %}
          </div>
        {% endif %}
      {% endwith %}
      <form method="post" enctype="multipart/form-data" class="upload-form" id="uploadForm" onsubmit="showLoading()">
        <div>
          <label for="activity" class="form-label">ğŸ“Š é€‰æ‹©åˆ†æç±»å‹</label>
          <select id="activity" name="activity" class="form-select">
            {% for option in activity_options %}
              <option value="{{ option.key }}" {% if option.key == selected_activity %}selected{% endif %}>
                {{ option.label }}
              </option>
            {% endfor %}
          </select>
        </div>
        <div>
          <label for="video" class="form-label">ğŸ¬ é€‰æ‹©è§†é¢‘æ–‡ä»¶</label>
          <input type="file" id="video" name="video" accept="video/*" required />
        </div>
        <button type="submit" id="submitBtn">
          ğŸš€ å¼€å§‹åˆ†æ
        </button>
        <div id="loadingMsg" style="display: none; padding: 1rem; text-align: center; color: #667eea; font-weight: 600;">
          â³ æ­£åœ¨åˆ†æè§†é¢‘ï¼Œè¯·ç¨å€™...ï¼ˆè¿™å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ—¶é—´ï¼‰
        </div>
      </form>
      <script>
        function showLoading() {
          const submitBtn = document.getElementById('submitBtn');
          const loadingMsg = document.getElementById('loadingMsg');
          
          submitBtn.disabled = true;
          submitBtn.textContent = 'â³ åˆ†æä¸­...';
          loadingMsg.style.display = 'block';
          
          // æ·»åŠ è¶…æ—¶æç¤º
          setTimeout(function() {
            if (submitBtn.disabled) {
              loadingMsg.innerHTML = 'â³ æ­£åœ¨åˆ†æè§†é¢‘ï¼Œè¯·ç¨å€™...ï¼ˆè¿™å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ—¶é—´ï¼‰<br><small style="color: #64748b;">å¦‚æœç­‰å¾…æ—¶é—´è¿‡é•¿ï¼Œè¯·æ£€æŸ¥æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯</small>';
            }
          }, 10000); // 10ç§’åæ˜¾ç¤ºæç¤º
        }
        
        // ç›‘å¬è¡¨å•æäº¤ï¼Œç¡®ä¿åŠ è½½æç¤ºæ˜¾ç¤º
        document.getElementById('uploadForm').addEventListener('submit', function(e) {
          showLoading();
          // ä¸é˜»æ­¢é»˜è®¤æäº¤ï¼Œè®©è¡¨å•æ­£å¸¸æäº¤
        });
        
        // æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯æ¶ˆæ¯
        window.addEventListener('load', function() {
          const flashMessages = document.querySelector('.flash');
          if (flashMessages) {
            // å¦‚æœæœ‰é”™è¯¯æ¶ˆæ¯ï¼Œç¡®ä¿æŒ‰é’®å¯ä»¥é‡æ–°æäº¤
            const submitBtn = document.getElementById('submitBtn');
            if (submitBtn) {
              submitBtn.disabled = false;
              submitBtn.textContent = 'ğŸš€ å¼€å§‹åˆ†æ';
            }
            const loadingMsg = document.getElementById('loadingMsg');
            if (loadingMsg) {
              loadingMsg.style.display = 'none';
            }
          }
        });
      </script>
    </div>
  </body>
</html>
